<!DOCTYPE html>
<html lang="en"><head><meta charset="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><title>WhereTraits Usage` · WhereTraits.jl</title><script data-outdated-warner src="../assets/warner.js"></script><link rel="canonical" href="https://jolin-io.github.io/WhereTraits.jl/usage/"/><link href="https://cdnjs.cloudflare.com/ajax/libs/lato-font/3.0.0/css/lato-font.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/juliamono/0.045/juliamono.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/fontawesome.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/solid.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/brands.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.13.24/katex.min.css" rel="stylesheet" type="text/css"/><script>documenterBaseURL=".."</script><script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" data-main="../assets/documenter.js"></script><script src="../siteinfo.js"></script><script src="../../versions.js"></script><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/documenter-dark.css" data-theme-name="documenter-dark" data-theme-primary-dark/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/documenter-light.css" data-theme-name="documenter-light" data-theme-primary/><script src="../assets/themeswap.js"></script></head><body><div id="documenter"><nav class="docs-sidebar"><div class="docs-package-name"><span class="docs-autofit"><a href="../">WhereTraits.jl</a></span></div><form class="docs-search" action="../search/"><input class="docs-search-query" id="documenter-search-query" name="q" type="text" placeholder="Search docs"/></form><ul class="docs-menu"><li><a class="tocitem" href="../">Home</a></li><li><span class="tocitem">Manual</span><ul><li class="is-active"><a class="tocitem" href>WhereTraits Usage`</a><ul class="internal"><li><a class="tocitem" href="#Usage-@traits"><span>Usage <code>@traits</code></span></a></li><li><a class="tocitem" href="#Usage-@traits_order-Resolving-Ambiguities"><span>Usage <code>@traits_order</code> - Resolving Ambiguities</span></a></li><li><a class="tocitem" href="#Limitations"><span>Limitations</span></a></li></ul></li><li><a class="tocitem" href="../details/">WhereTraits Details`</a></li><li><a class="tocitem" href="../basictraits/">WhereTraits.BasicTraits</a></li></ul></li><li><a class="tocitem" href="../library/">Library</a></li></ul><div class="docs-version-selector field has-addons"><div class="control"><span class="docs-label button is-static is-size-7">Version</span></div><div class="docs-selector control is-expanded"><div class="select is-fullwidth is-size-7"><select id="documenter-version-selector"></select></div></div></div></nav><div class="docs-main"><header class="docs-navbar"><nav class="breadcrumb"><ul class="is-hidden-mobile"><li><a class="is-disabled">Manual</a></li><li class="is-active"><a href>WhereTraits Usage`</a></li></ul><ul class="is-hidden-tablet"><li class="is-active"><a href>WhereTraits Usage`</a></li></ul></nav><div class="docs-right"><a class="docs-edit-link" href="https://github.com/jolin-io/WhereTraits.jl/blob/main/docs/src/usage.md#L" title="Edit on GitHub"><span class="docs-icon fab"></span><span class="docs-label is-hidden-touch">Edit on GitHub</span></a><a class="docs-settings-button fas fa-cog" id="documenter-settings-button" href="#" title="Settings"></a><a class="docs-sidebar-button fa fa-bars is-hidden-desktop" id="documenter-sidebar-button" href="#"></a></div></header><article class="content" id="documenter-page"><h1 id="WhereTraits-Usage"><a class="docs-heading-anchor" href="#WhereTraits-Usage">WhereTraits Usage</a><a id="WhereTraits-Usage-1"></a><a class="docs-heading-anchor-permalink" href="#WhereTraits-Usage" title="Permalink"></a></h1><h2 id="Usage-@traits"><a class="docs-heading-anchor" href="#Usage-@traits">Usage <code>@traits</code></a><a id="Usage-@traits-1"></a><a class="docs-heading-anchor-permalink" href="#Usage-@traits" title="Permalink"></a></h2><p><code>@traits</code> supports the following three extensions to Julia&#39;s where-syntax:</p><ul><li>dispatch on functions returning Bool</li></ul><pre><code class="language-julia hljs">@traits f(a) where {isodd(a)} = (a+1)/2
@traits f(a) where {!isodd(a)} = a/2
f(4) # 2.0
f(5) # 3.0</code></pre><ul><li>dispatch on functions returning anything</li></ul><pre><code class="language-julia hljs">@traits g(a) where {Base.IteratorSize(a)::Base.HasShape} = 43
@traits g(a) = 1
g([1,2,3]) # 43
g(Iterators.repeated(1)) # 1</code></pre><ul><li>dispatch on upperbounds on functions returning Types</li></ul><pre><code class="language-julia hljs">@traits h(a) where {eltype(a) &lt;: Number} = true
@traits h(a) = false
h([1.0]) # true
h([&quot;&quot;]) # false</code></pre><p>And all this works with arbitrary many where expressions and creates optimal code where possible via standard Julia compiler.</p><h2 id="Usage-@traits_order-Resolving-Ambiguities"><a class="docs-heading-anchor" href="#Usage-@traits_order-Resolving-Ambiguities">Usage <code>@traits_order</code> - Resolving Ambiguities</a><a id="Usage-@traits_order-Resolving-Ambiguities-1"></a><a class="docs-heading-anchor-permalink" href="#Usage-@traits_order-Resolving-Ambiguities" title="Permalink"></a></h2><p><code>WhereTraits</code> comes with special support for resolving ambiguities among traits dispatch. </p><p>Under the hood <code>@traits</code> uses normal function dispatch to acchieve the speed and flexibility, however, julia function dispatch can lead to disambiguities. With traits these can easily happen if someone defines <code>@traits</code> for the same standard dispatch but using different traits. Let&#39;s take a look how this looks like</p><pre><code class="language-julia hljs">using WhereTraits
# let&#39;s say someone defined this version
@traits conflict(a) where {eltype(a) &lt;: Number} = &quot;eltype wins&quot;
# and another this one
@traits conflict(a) where {Base.IteratorSize(a) :: Base.HasShape} = &quot;IteratorSize wins&quot;</code></pre><p>You can still use these traits definition as long as there is no ambiguity.</p><pre><code class="language-julia hljs">julia&gt; conflict(Iterators.countfrom(42))
&quot;eltype wins&quot;

julia&gt; conflict([&quot;hello&quot;, &quot;world&quot;])
&quot;IteratorSize wins&quot;</code></pre><p>If you use something ambiguous, e.g. a <code>Vector</code> of <code>Number</code>s, you get a proper ambiguity error, stating what you can do in order to fix it.</p><pre><code class="language-julia hljs">julia&gt; conflict([1,2,3,4])
ERROR: Disambiguity found. Please specify an ordering between traits, like the following.

    @traits_order (Main).conflict(a1::T1) where T1 begin
        eltype(a1)
        Base.IteratorSize(a1)
    end

Stacktrace:
[...]</code></pre><p>What is needed in order to resolve the ambiguity is an order between the traits. This can be defined with <code>@traits_order</code>, which takes the respective function signature followed by a begin-end block of ordered traits (most dominant one should be at the top).</p><p>Hence just executing the example <code>@traits_order</code> will make <code>eltype</code> be the winning trait.</p><pre><code class="language-julia hljs">@traits_order (Main).conflict(a1::T1) where T1 begin
    eltype(a1)
    Base.IteratorSize(a1)
end</code></pre><p>Let&#39;s take a look that everything is resolved</p><pre><code class="language-julia hljs">julia&gt; conflict([1,2,3,4])
&quot;eltype wins&quot;</code></pre><p>Alternatively to the <code>@traits_order</code> you can always define your own custom resolution</p><pre><code class="language-julia hljs">@traits function conflict(a) where {eltype(a) &lt;: Number, Base.IteratorSize(a) :: Base.HasShape}
    &quot;custom implementation&quot;
end</code></pre><p>which immediately will resolve correctly</p><pre><code class="language-julia hljs">julia&gt; conflict([1,2,3,4])
&quot;custom implementation&quot;</code></pre><p>For more details, take a look at the <a href="https://jolin-io.github.io/WhereTraits.jl/dev">documentation</a>.</p><h2 id="Limitations"><a class="docs-heading-anchor" href="#Limitations">Limitations</a><a id="Limitations-1"></a><a class="docs-heading-anchor-permalink" href="#Limitations" title="Permalink"></a></h2><h3 id="Optimal-Code"><a class="docs-heading-anchor" href="#Optimal-Code">Optimal Code</a><a id="Optimal-Code-1"></a><a class="docs-heading-anchor-permalink" href="#Optimal-Code" title="Permalink"></a></h3><p><em>Warning: While the dispatch works for dynamic functions, it will only be able to create optimal code if your traits function supports proper type-inference. E.g. you can use <code>Base.isempty</code>, however type-inference cannot see whether it will return true or false by static inspection. Hence it will use slower dynamic code.</em></p><h3 id="Keyword-arguments"><a class="docs-heading-anchor" href="#Keyword-arguments">Keyword arguments</a><a id="Keyword-arguments-1"></a><a class="docs-heading-anchor-permalink" href="#Keyword-arguments" title="Permalink"></a></h3><p>Keyword arguments are at the moment not support for WhereTraits dispatch. They are just passed through.</p><h3 id="Symbol-Level"><a class="docs-heading-anchor" href="#Symbol-Level">Symbol Level</a><a id="Symbol-Level-1"></a><a class="docs-heading-anchor-permalink" href="#Symbol-Level" title="Permalink"></a></h3><p>The extended where syntax is currently implemented on <strong>symbol level</strong>, which is why traits functions like <code>Base.IteratorSize</code> and the non-qualified <code>IteratorSize</code> (assuming you imported <code>import Base: IteratorSize</code>) are treated as two different functions, despite being the same. So for now try to only use the one style or the other.</p><h3 id="Top-Level-Only"><a class="docs-heading-anchor" href="#Top-Level-Only">Top Level Only</a><a id="Top-Level-Only-1"></a><a class="docs-heading-anchor-permalink" href="#Top-Level-Only" title="Permalink"></a></h3><p>Currently <strong>only top-level functions</strong> are supported, as the syntax stores and needs information about previous function definitions, which it stores globally. If macros would get informed about whether they are defined within another function, WhereTraits could also support innerfunctions. </p><h3 id="Test-package"><a class="docs-heading-anchor" href="#Test-package">Test package</a><a id="Test-package-1"></a><a class="docs-heading-anchor-permalink" href="#Test-package" title="Permalink"></a></h3><p>The <code>@traits</code> macro currently does not work well within the <code>Test.@testset</code> macro. Usually you won&#39;t encounter this, as standard dispatch is probably enough for your tests.</p><p>Nevertheless there is a workaround. WhereTraits.jl exports a <code>@traits_test</code> macro variant which works better, but still might have cases where it fails. This needs to be investigated further, and maybe needs a change on <code>Test.@testset</code>.</p></article><nav class="docs-footer"><a class="docs-footer-prevpage" href="../">« Home</a><a class="docs-footer-nextpage" href="../details/">WhereTraits Details` »</a><div class="flexbox-break"></div><p class="footer-message">Powered by <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> and the <a href="https://julialang.org/">Julia Programming Language</a>.</p></nav></div><div class="modal" id="documenter-settings"><div class="modal-background"></div><div class="modal-card"><header class="modal-card-head"><p class="modal-card-title">Settings</p><button class="delete"></button></header><section class="modal-card-body"><p><label class="label">Theme</label><div class="select"><select id="documenter-themepicker"><option value="documenter-light">documenter-light</option><option value="documenter-dark">documenter-dark</option></select></div></p><hr/><p>This document was generated with <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> version 0.27.21 on <span class="colophon-date" title="Monday 18 July 2022 19:00">Monday 18 July 2022</span>. Using Julia version 1.7.3.</p></section><footer class="modal-card-foot"></footer></div></div></div></body></html>
